---
title: 非同步(異步)
tags: AJAX
categories: AJAX
---
#### 前言
在 JavaScript 中程式一次只執行一件事情，
非同步的特色: 全部程式執行完.最後才會執行。
(事情先放到 "event queue 事件佇列" 裡面)
有時間差.沒辦法確定什麼時間開始執行、完畢。
<!--more-->
非同步程式:
setTimeout、addEventListener、AJAX相關...
(需要花時間等待.但主要程式不會等。)

解決方式3種:
- Callbacks(回呼函式)
- Promise(物件-承諾)
- Async(語法-非同步)/ Await(等待)

範例 1.一般同步的程式
```
<button type="button" onclick="clickFun()">click</button>

<script>
  function number(n1, n2){
    return n1+n2;
  }
  function clickFun(){
    let res = number(4, 8);
    console.log(res); // 12
  }
</script>
```

範例 2.加入非同步的程式
```
function number(n1, n2, delayTime){
  console.log('a')
  setTimeout(function(){  //加入非同步程式
    console.log('b')
    return n1+n2;
  },delayTime);
  console.log('c')
}
function clickFun(){
  let res = number(4, 8, 2000);
  console.log(res);  //undefined
}
```
顯示順序: a c undefined b

為了解決上面抓不到值、時間順序的問題.
有下面3種方法把資料抓出來。

#### Callbacks(回呼函式)
使用函式當參數用。

(第9行是一個函式當參數傳遞到第一行的 callback 這參數使用。
第3行是利用這參數名稱呼叫，把值回傳回去，所以第10行才有結果。)
按了之後要等設定的2秒鐘.才會回傳對的值。

```
function number(n1, n2, delayTime, callback){
  setTimeout(function(){  
    callback(n1+n2);  //把資料帶出去
  },delayTime);
}
function clickFun(){
  // 刪除 let res = number(4, 8, 2000);
  // 整個換掉  
  number(4, 8, 2000, function(res){
    console.log(res);  //undefined
  })
}
```

#### Promise(物件-承諾)
要使用 return 
```
function number(n1, n2, delayTime, callback){
  setTimeout(function(){  
    callback(n1+n2);  //把資料帶出去
  },delayTime);
}
function clickFun(){
  // 刪除 let res = number(4, 8, 2000);
  // 整個換掉  
  number(4, 8, 2000, function(res){
    console.log(res);  //undefined
  })
}
```



