---
title: VueX - 3. Getter、Modules 簡化與模組化
categories: Vue
tags: 
  - Vue
  - VueX
---
### Getter
目的: 資料呈現前調整(類似 computed )。
資料出現在網頁上之前做一些過濾、加減
<!--more-->
相關行為從 store 讀出來
有 mapGetters、mapActions 這 2 個簡化程式
mapGetters 針對 computed 簡化
mapActions 針對 methods 簡化
方式差不多。

#### mapGetters 針對 computed 簡化
把 computed 中使用到 vuex 的部分移動到 getter 中
1. 在 component 中引入 getter
  加入```import { mapGetters } from 'vuex';```
  可以取出所有的 getter
  注意 { mapGetters } 是物件形式.不要忘了加只寫名稱!
  ```
  <script>
  import { mapGetters } from 'vuex'; // 加入這段
  export default {...}
  </script>
  ```

2. 原本 component 中的設定.改成在 vuex 中的 getter

  A. 原本 component 中的程式
  ```
  computed: {
    isLoading(){
        return this.$store.state.isLoading;
      },
    cart(){
      return this.$store.state.cart;
    }
  },
  ```

  改成在 vuex 中 getter 樣子(也是要 return 回傳資料)
  ```
  getters:{
    isLoading(state){
      return state.isLoading;
    },
    cart(state){
      return state.cart;
    }
  }
  ```

  B. 原本 component 中的
  ```
  // 原本樣子
  computed: {
    isLoading(){
        return this.$store.state.isLoading;
      },
    cart(){
      return this.$store.state.cart;
    }
  },

  // 改成這樣
  computed: {
    ...mapGetters(['isLoading', 'cart'])
  },
  ```

#### mapActions 針對 methods 簡化
1. 加入 mapActions
  ```
  <script>
  import { mapGetters, mapActions } from 'vuex'; // 加入這段
  export default {...}
  </script>
  ```

2. 改變 component 中的設定
  原本樣子
  ```
  methods: {
    // 這可以簡化
    addCartProductIn() {
      this.$store.dispatch('addCartProductIn');
    },
    // 這無法簡化.因為有參數需要傳入
    changeNum(num) {
      this.$store.dispatch('changeNum', num)
    },
  },
  ```

  修改後
  ```
  methods: {
    changeNum(num) {
      this.$store.dispatch('changeNum', num)
    },
    ...mapActions(['addCartProductIn']), // 改這邊
  },
  ```

-------------------------------------------------------------------
### Modules
目的: VueX 檔案模組化
分成幾個檔案.引入加上來的地方。

1. 新增模板並把相關資料移動進去
index.js 這檔案是先建立一個 vuex
而新的檔案不需要.裡面先寫成下面這樣
也不需要 strict:true

  ```
  import axios from 'axios'; // 如果需要axios在增加
  export default:{
  }
  ```

  在把 index.js 中 state、mutations、actions、getters 一起複製過去
  增加刪減

  這邊當時卡了一下.因為一開始複製整個 index.js 過去改
  vuex重複2次創建.所以產生錯誤查到下面文章解決
  [[vuex] getters should be function but](https://github.com/vuejs/vuex/issues/1748)

2. 在 index.js 中引入
  A. import 進來模板
  ```
  import Vue from 'vue'
  import Vuex from 'vuex'
  import axios from 'axios';

  import productsModules from "./products"; // 加入這段引用進來

  Vue.use(Vuex)  //這邊 vuex 啟用
  export default new Vuex.Store({.....})
  ```

  B. 增加 modules
  ```
  export default new Vuex.Store({
    strict: true,
    state: {...},
    mutations: {...},
    actions: {...},
    getters:{...},
    modules: { //其他模板引入
      productsModules,
    }
  })
  ```

  改到這邊檔案是沒問題的

  #### 注意幾個重點
  ##### 一般情況:
  - state 模組區域變數
  - actions、mutations、getters 全域變數
    (全域擔心的是跟其他檔案的名稱一樣造成衝突)
  
  ##### 全都變成區域變數:
  設定 ```namespaced: true,```
  ```
  export default {
  namespaced: true,
  state: {..},
  ```
<br>
A. 使用到 index.js 頁面的加入 ```{root: true}``` 回到根目錄
下面程式會回到跟目錄找 LOADING
```
context.commit('LOADING', true, {root: true});
```
<br>

  B. component 中 mapGetters、mapActions
  使用到的地方.要加檔案名稱 ```'productModules'```

  ```
  ...mapGetters('productModules',['dataProduct2', 'selectNum2']),
  ```
<br>

  C. component 中 methods 使用到的地方
  路徑需要更改 (文件引入index.js的名稱/actions 下的方法)
  ```
  this.$store.dispatch('productModules/cartBtnApi');
  ```
<br>
  沒用會出現報錯 ```[vuex] unknown action type:```
  這邊卡了一下.
  雖然檔名是 product.js 但是引入 index.js 時是下面這樣
  import productModules from "./products";
  所以名稱是 productModules 不是 product

##### 模組化後調用其他模組的方法
[vuex 模块化之后如何调用其他模块的方法和属性](https://www.jianshu.com/p/5c467a3e1ca9)
[modules 1 ](https://ithelp.ithome.com.tw/articles/10209719)
[modules 2](https://ithelp.ithome.com.tw/articles/10209848)

<!-- 如果要使用到其他模組的 mutation、action，需要在 dispatch、commit 的第三個參數帶入 ```{ root: true }```，表示這個 mutation、action 不是目前模組的。  

A. commit 用於 mutation 來動態更新 state，當前模組和其他模組


B. dispatch 用於 action，當前模組和其他模組
自己模組的不用命名，其他模組需要在 action 路徑上命名
```
//加上在 index.js 中引入的模組名稱 productModules
this.$store.dispatch('productModules/selectCategory', {style,isPageClick});
```

C. getters 獲取當前模組 getter；
D. state 獲取當前模組 state；
E. rootState 獲取其他模組 state；
F. rootGetters 獲取其他模組 getter -->


